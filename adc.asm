; This program takes ten readings
; from the ADC at 50 us intervals
; (assuming system clock is 12 MHz)
; and stores them in RAM, starting at
; address 30H.

CS EQU P3.1
WR EQU P3.6
RD EQU P3.7
DATA_LINES EQU P2
BUFFER EQU 30H


ORG 0
	JMP main
ORG 3
	JMP external0ISR
ORG 0BH
	JMP timer0ISR
ORG 30H
main:
	MOV R0, #BUFFER
	CLR CS
	MOV TMOD, #2
	MOV TH0, #-50
	MOV TL0, #-50
	SETB TR0
	SETB ET0
	SETB EX0
	SETB IT0
	SETB EA
	JMP $

timer0ISR:
	CLR WR
	SETB WR
	RETI

external0ISR:
	CLR RD
	MOV @R0, DATA_LINES
	CALL DACto31H
	CALL DISPLAY
	SETB RD

endExternal0ISR:
	RETI
DACto31H:
	MOV A,30H
	MOV B,#51
	DIV AB
	MOV 31H,A
	MOV A,B
	MOV B,#5
	DIV AB
	MOV 32H,A
	RET
DISPLAY:
	MOV DPTR,#TABL1
	MOV A,31H
	MOVC A,@A+DPTR
	MOV 33H,A

	MOV DPTR,#TABL0
	MOV A,32H
	MOVC A,@A+DPTR
	MOV 34H,A


	SETB P3.3
	SETB P3.4
	MOV P1,33H
	CALL DELAY
	CLR P3.3
	MOV P1,34H
	RET
DELAY:
	MOV R1, #20
	DJNZ R1, $
	RET

TABL0:	;鍵盤無小數點
	DB	C0H;0
	DB	F9H;1
	DB	A4H;2
	DB	B0H;3
	DB	99H;4
	DB	92H;5
	DB	82H;6
	DB	F8H;7
	DB	80H;8	
	DB	90H;9
TABL1:	;鍵盤有小數點
	DB	40H;0
	DB	76H;1
	DB	24H;2
	DB	30H;3
	DB	19H;4
	DB	12H;5
	DB	02H;6
	DB	78H;7
	DB	0H;8	
	DB	10H;9

